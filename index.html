<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Qu·∫ª ƒê·ªãnh M·ªánh 10/5 ‚Äî X√≥c 6 L√°</title>

<!-- confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
  --red:#c0392b;
  --gold:#ffd700;
  --paper:#fff5e6;
  --wood1:#6d4c41;
  --wood2:#4b2e2e;
  --card-w:78px;
  --card-h:114px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto;}
body{
  background:linear-gradient(180deg,#fff7ee,#efe1d0);
  display:flex;align-items:center;justify-content:center;padding:14px;
}
.panel-wrap{
  width:100%;max-width:980px;
  padding:18px;background:linear-gradient(180deg,var(--wood1),var(--wood2));
  border-radius:18px;box-shadow:0 18px 50px rgba(0,0,0,.45);
}
.panel{
  background:var(--paper);border-radius:12px;padding:16px;border:6px solid #3b2a20;
  min-height:560px;
}
.header{display:flex;justify-content:space-between;align-items:center}
.title{color:var(--red);margin:0;font-size:1.25rem}
.subtitle{color:#5a4038;font-size:.9rem}
.center{display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:12px}
.tube{width:120px;height:160px;border-radius:14px;background:linear-gradient(180deg,#4b2e2e,#2f1f18);display:flex;align-items:center;justify-content:center;box-shadow:0 10px 25px rgba(0,0,0,.35);transform-origin:center}
.energy{width:84%;height:8px;background:#efe2d2;border-radius:999px;overflow:hidden;margin-top:10px}
.energy-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--gold),#ffd96a);transition:width .25s linear}

.cards-area{width:100%;height:160px;position:relative;display:flex;align-items:center;justify-content:center}
.card{
  width:var(--card-w);height:var(--card-h);border-radius:8px;
  background:
    linear-gradient(180deg,#fff7ed,#f6ead6),
    repeating-linear-gradient(45deg, rgba(0,0,0,0.02) 0 2px, transparent 2px 6px);
  border:2px solid rgba(0,0,0,0.06);
  box-shadow:0 10px 18px rgba(0,0,0,.22);
  position:absolute;display:flex;align-items:center;justify-content:center;font-weight:900;color:var(--red);
  transform-origin:bottom center;user-select:none;touch-action:manipulation;
  transition:transform .28s ease, box-shadow .18s ease, top .28s;
}
.card.shake{animation:cardShake .32s infinite}
@keyframes cardShake{
  0%{transform:translateY(0) rotate(0deg)}
  25%{transform:translateY(-6px) rotate(-3deg)}
  50%{transform:translateY(0) rotate(3deg)}
  75%{transform:translateY(-6px) rotate(-2deg)}
  100%{transform:translateY(0) rotate(0deg)}
}

.controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
button{padding:10px 14px;border-radius:10px;border:none;font-weight:800;cursor:pointer}
.btn-primary{background:linear-gradient(180deg,var(--red),#9e2a24);color:#fff}
.btn-gold{background:linear-gradient(180deg,var(--gold),#e6c200);color:#3b2a20}
.btn-muted{background:transparent;border:2px dashed rgba(0,0,0,.06);color:#6b4a39}

.result{margin-top:12px;padding:14px;border-radius:12px;background:linear-gradient(180deg,#fffdf6,#fff6ea);min-height:120px}
.result.good{border-left:6px solid rgba(34,139,34,.18)}
.result.bad{border-left:6px solid rgba(0,0,0,.08)}
.vip-badge{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--gold),#fff085);font-weight:900;margin-left:8px;color:#3b2a20}
.notice{margin-top:10px;padding:12px;border-radius:10px;background:linear-gradient(90deg,#fff6d6,#fff0bf);font-weight:800;color:#3b2a20;text-align:center}

.modal{position:fixed;inset:0;background:rgba(12,7,6,.6);display:flex;align-items:center;justify-content:center;z-index:999}
.modal-box{background:var(--paper);padding:16px;border-radius:12px;width:92%;max-width:420px}
.row{display:flex;gap:8px;align-items:center;margin-top:8px}
input[type=text],input[type=date]{padding:8px;border-radius:8px;border:1px solid #d8c9bf;flex:1}

@media (max-width:520px){
  :root{--card-w:64px;--card-h:98px}
  .tube{width:100px;height:140px}
  .panel{padding:12px}
}
</style>
</head>
<body>

<div class="panel-wrap">
  <div class="panel" role="main" aria-live="polite">
    <div class="header">
      <div>
        <h1 class="title">üîÆ XIN QU·∫∫ 10/5 ‚Äî X√ìC 6 L√Å</h1>
        <div class="subtitle">M·ªôt l·∫ßn/m√°y ‚Äî T·ªâ l·ªá tr√∫ng m√≥c kh√≥a 10%</div>
      </div>
      <div style="color:#5a4038;font-size:.9rem">Tone: <strong style="color:var(--red)">ƒê·ªè ƒë√¥</strong> ¬∑ <strong style="color:var(--gold)">V√†ng kim</strong></div>
    </div>

    <div class="center">
      <div id="tube" class="tube" aria-hidden="true">
        <svg width="56" height="56" viewBox="0 0 24 24"><path fill="#f6e0cf" d="M12 2c1.1 0 2 .9 2 2v4h-4V4c0-1.1.9-2 2-2z"/><path fill="#3b2a20" d="M7 7v12c0 2.2 1.8 4 4 4s4-1.8 4-4V7H7z"/></svg>
      </div>

      <div class="energy" aria-hidden="true"><div id="energyFill" class="energy-fill"></div></div>

      <div class="cards-area" id="cardsArea" aria-hidden="true"></div>

      <div class="controls" id="controls">
        <button id="btn-start" class="btn-primary">B·∫ÆT ƒê·∫¶U</button>
        <button id="btn-shake" class="btn-gold" disabled>L·∫ÆC ·ªêNG</button>
        <button id="btn-reset" class="btn-muted">Reset (dev)</button>
      </div>

      <div id="resultBox" class="result">
        <div id="status"><strong>Tr·∫°ng th√°i:</strong> Ch∆∞a r√∫t qu·∫ª</div>
        <div id="hint" style="margin-top:8px;color:#5a4038">B·∫•m B·∫ÆT ƒê·∫¶U ‚Üí X√°c nh·∫≠n 2 b∆∞·ªõc ‚Üí L·∫ÆC ·ªêNG ‚Üí Ch·ªçn 1 trong 6 l√° ƒë·ªÉ bi·∫øt qu·∫ª c·ªßa b·∫°n.</div>
      </div>
    </div>

    <footer style="margin-top:10px;color:#6b4a39;font-size:.9rem">Qu√†: <strong>M√≥c kh√≥a</strong> ¬∑ T·ªâ l·ªá tr√∫ng: <strong>10%</strong> ¬∑ VIP: nh·∫≠p ng√†y sinh 2010-06-25</footer>
  </div>
</div>

<!-- modals -->
<div id="modal1" class="modal" style="display:none">
  <div class="modal-box">
    <h3>B·∫°n ƒë√£ s·∫µn s√†ng ch∆∞a?</h3>
    <p class="subtitle">Nh·∫•n "ƒê·ªìng √Ω" ƒë·ªÉ qua b∆∞·ªõc ti·∫øp theo (c·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ m·ªü audio).</p>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="m1-no" class="btn-muted">Ch∆∞a</button>
      <button id="m1-yes" class="btn-primary">ƒê·ªíNG √ù</button>
    </div>
  </div>
</div>

<div id="modal2" class="modal" style="display:none">
  <div class="modal-box">
    <h3>T∆∞∆°ng lai 2026 c·ªßa b·∫°n l√† g√¨?</h3>
    <p class="subtitle">Vi·∫øt 1 c√¢u ng·∫Øn (v√≠ d·ª•: "V√¥ ƒë·ªãch b√≥ng chuy·ªÅn").</p>
    <div class="row">
      <input id="futureInput" type="text" placeholder="V√≠ d·ª•: V√¥ ƒë·ªãch b√≥ng chuy·ªÅn 10/5" />
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="m2-cancel" class="btn-muted">H·ªßy</button>
      <button id="m2-done" class="btn-primary">KH√ÅM PH√Å</button>
    </div>
  </div>
</div>

<script>
/* -----------------------------------------
  Config & data
------------------------------------------*/
const STORAGE_KEY = 'que_10_5_single_draw_v3';
const VIP_DATE = '2010-06-25';
const GIFT_PROB = 0.10; // 10%

/* build 100 fortunes: 50 good (20 camp-benefit), 50 bad */
const goodTemplates = [
  "ƒê·∫°i c√°t: May m·∫Øn l·ªõn, h·ªçc h√†nh ti·∫øn b·ªô. Gh√© qu·∫ßy 10/5 mua n∆∞·ªõc ƒë·ªÉ k√≠ch v·∫≠n.",
  "L·ªôc ƒÉn: C√≥ c∆° may nh·ªè, nh·∫≠n l·ªùi khen. H√£y ·ªßng h·ªô qu·∫ßy 10/5.",
  "Ph√∫c l·ªôc: Ph√∫c d·ªìi d√†o, g·∫∑p ng∆∞·ªùi t·ªët. Mua n∆∞·ªõc ƒë·ªÉ c·∫£m ∆°n.",
  "Ti·ªÉu c√°t: Vi·ªác nh·ªè th√†nh c√¥ng, gi·ªØ tinh th·∫ßn l·∫°c quan.",
  "Th·ªãnh v∆∞·ª£ng: V·∫≠n h·ªçc h√†nh thu·∫≠n l·ª£i; ƒë·ªôi tr·∫°i c√≥ c∆° h·ªôi v∆∞∆°n l√™n."
];
const campBenefits = [
  "R√°ng c·ªë g·∫Øng, ƒë·ª´ng s√¢n si ‚Äî 10/5 s·∫Ω c√≥ c∆° h·ªôi v√¥ ƒë·ªãch b√≥ng chuy·ªÅn.",
  "ƒêo√†n k·∫øt, t·∫≠p trung; tinh th·∫ßn ƒë·ªôi gi√∫p 10/5 ti·∫øn xa.",
  "ChƒÉm luy·ªán, gi·ªØ h√≤a kh√≠; ph·∫ßn th∆∞·ªüng d√†nh cho t·∫≠p th·ªÉ.",
  "Gi√∫p nhau, 10/5 s·∫Ω ƒë∆∞·ª£c vinh danh trong tr·∫°i.",
  "Tinh th·∫ßn ƒë·ªìng ƒë·ªôi: m·ªôt h√†nh ƒë·ªông nh·ªè c√≥ th·ªÉ d·∫´n t·ªõi chi·∫øn th·∫Øng."
];
const badTemplates = [
  "H·∫°n th·ªã phi: C·∫©n th·∫≠n l·ªùi n√≥i, tr√°nh g√¢y hi·ªÉu l·∫ßm.",
  "Ti·ªÉu hung: Tr·ªü ng·∫°i nh·ªè, gi·ªØ b√¨nh tƒ©nh, ch·ªù c∆° h·ªôi.",
  "C·∫©n tr·ªçng: M·ªôt v√†i r·∫Øc r·ªëi v·ªÅ ƒë·ªì ƒë·∫°c ho·∫∑c l·ªãch h·ªçc.",
  "Sao x·∫•u: T·∫°m th·ªùi h∆°i kh√≥ khƒÉn, gi·ªØ s·ª©c kh·ªèe.",
  "Xui nh·ªè: ƒê·ª´ng n√≥ng v·ªôi, m·ªçi chuy·ªán qua nhanh."
];

let fortunes = [];
for(let i=0;i<50;i++){
  let text = (i<20) ? campBenefits[i % campBenefits.length] : goodTemplates[i % goodTemplates.length];
  fortunes.push({id:i+1, title:"May m·∫Øn", text, category:"good"});
}
for(let i=0;i<50;i++){
  let text = badTemplates[i % badTemplates.length];
  fortunes.push({id:51+i, title:"Xui x·∫ªo", text, category:"bad"});
}
// shuffle
(function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
})(fortunes);

/* -----------------------------------------
  Audio: WebAudio SFX (click, shake-loop, swipe, win, sad)
------------------------------------------*/
let audioCtx=null, masterGain=null, shakeInterval=null;
function ensureAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain(); masterGain.gain.value = 0.9;
    masterGain.connect(audioCtx.destination);
  }
}
function sfxClick(){
  ensureAudio();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type = 'square'; o.frequency.value = 1200;
  g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.12, audioCtx.currentTime+0.002);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.12);
  o.connect(g); g.connect(masterGain);
  o.start(); o.stop(audioCtx.currentTime+0.14);
}
function sfxStartShake(){
  ensureAudio();
  if(shakeInterval) return;
  shakeInterval = setInterval(()=>{
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type='triangle'; o.frequency.value = 380 + Math.random()*220;
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.08, audioCtx.currentTime+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.18);
    o.connect(g); g.connect(masterGain);
    o.start(); o.stop(audioCtx.currentTime+0.18);
  }, 140);
}
function sfxStopShake(){
  if(shakeInterval){ clearInterval(shakeInterval); shakeInterval=null; }
}
function sfxSwipe(){
  ensureAudio();
  const now = audioCtx.currentTime;
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type='sawtooth';
  o.frequency.setValueAtTime(900, now);
  o.frequency.exponentialRampToValueAtTime(160, now+0.35);
  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(0.12, now+0.008);
  g.gain.exponentialRampToValueAtTime(0.0001, now+0.55);
  o.connect(g); g.connect(masterGain);
  o.start(); o.stop(now+0.6);
}
function sfxWin(){
  ensureAudio();
  const notes=[660,880,990];
  let t=audioCtx.currentTime;
  notes.forEach(n=>{
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type='triangle'; o.frequency.value=n;
    g.gain.setValueAtTime(0.0001, t);
    g.gain.exponentialRampToValueAtTime(0.16, t+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, t+0.26);
    o.connect(g); g.connect(masterGain); o.start(t); o.stop(t+0.28);
    t += 0.18;
  });
}
function sfxSad(){
  ensureAudio();
  const notes=[440,392,349];
  let t=audioCtx.currentTime;
  notes.forEach(n=>{
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type='sine'; o.frequency.value=n;
    g.gain.setValueAtTime(0.0001, t);
    g.gain.linearRampToValueAtTime(0.14, t+0.06);
    g.gain.linearRampToValueAtTime(0.0001, t+0.9);
    o.connect(g); g.connect(masterGain);
    o.start(t); o.stop(t+0.95);
    t += 0.8;
  });
}

/* -----------------------------------------
  DOM & Flow
------------------------------------------*/
const btnStart = document.getElementById('btn-start');
const btnShake = document.getElementById('btn-shake');
const btnReset = document.getElementById('btn-reset');
const modal1 = document.getElementById('modal1');
const modal2 = document.getElementById('modal2');
const m1no = document.getElementById('m1-no');
const m1yes = document.getElementById('m1-yes');
const m2cancel = document.getElementById('m2-cancel');
const m2done = document.getElementById('m2-done');
const futureInput = document.getElementById('futureInput');
const cardsArea = document.getElementById('cardsArea');
const energyFill = document.getElementById('energyFill');
const resultBox = document.getElementById('resultBox');
const status = document.getElementById('status');
const hint = document.getElementById('hint');

let hasDrawn = false;
let storedResult = null;
let isShaking = false;

/* check previous */
(function loadPrev(){
  const prev = localStorage.getItem(STORAGE_KEY);
  if(prev){
    storedResult = JSON.parse(prev);
    hasDrawn = true;
    displayResult(storedResult, true);
  }
})();

/* start flow */
btnStart.addEventListener('click', ()=>{
  sfxClick();
  modal1.style.display = 'flex';
});
m1no.addEventListener('click', ()=>{ sfxClick(); modal1.style.display='none'; });
m1yes.addEventListener('click', ()=>{ sfxClick(); modal1.style.display='none'; modal2.style.display='flex'; });
m2cancel.addEventListener('click', ()=>{ sfxClick(); modal2.style.display='none'; });
m2done.addEventListener('click', async ()=>{
  sfxClick();
  const txt = futureInput.value?.trim() || '';
  sessionStorage.setItem('future_affirm', txt);
  try{ ensureAudio(); if(audioCtx.state==='suspended') await audioCtx.resume(); }catch(e){}
  modal2.style.display='none';
  if(hasDrawn){
    hint.innerText = 'B·∫°n ƒë√£ r√∫t tr∆∞·ªõc ƒë√≥ ‚Äî k·∫øt qu·∫£ hi·ªÉn th·ªã b√™n d∆∞·ªõi.';
  } else {
    hint.innerText = 'Nh·∫•n L·∫ÆC ·ªêNG ƒë·ªÉ x√≥c 6 l√°, sau ƒë√≥ ch·ªçn 1 l√° ƒë·ªÉ nh·∫≠n qu·∫ª.';
    btnShake.disabled = false;
  }
});

/* shake: show 6 random cards with texture & slight jitter */
btnShake.addEventListener('click', ()=>{
  if(hasDrawn) return;
  sfxClick();
  // start shake audio & vibrate
  sfxStartShake();
  navigator.vibrate?.(80);
  // visual: add temporary shaking class to tube & cards
  const tube = document.getElementById('tube');
  const tubeAnim = tube.animate([{transform:'rotate(0deg)'},{transform:'rotate(12deg)'},{transform:'rotate(-12deg)'},{transform:'rotate(6deg)'},{transform:'rotate(-4deg)'},{transform:'rotate(0deg)'}],{duration:420,iterations:7});
  // prepare 6 random fortunes indices (but do not reveal yet)
  const six = pickSixUnique(fortunes.length,6);
  // build six card elements
  cardsArea.innerHTML = '';
  const midIndex = 3; // center reference for layout
  six.forEach((fIndex,i)=>{
    const card = document.createElement('div');
    card.className = 'card shake';
    // position
    const offset = (i - (six.length-1)/2);
    const leftPercent = 50 + offset * 12;
    card.style.left = leftPercent + '%';
    card.style.zIndex = 200 - Math.abs(offset);
    // front design: show small ornament instead of text
    card.innerHTML = `<div style="text-align:center;line-height:1.05rem"><div style="font-size:.8rem;color:#3b2a20">Qu·∫ª</div><div style="font-size:.65rem;color:#7a523f;margin-top:6px">10/5</div></div>`;
    // attach data attribute with fortune index
    card.dataset.index = fIndex;
    // click to reveal (user chooses one)
    card.addEventListener('click', onChooseCard);
    cardsArea.appendChild(card);
  });
  // animate subtle pop-in
  const cardNodes = document.querySelectorAll('.card');
  cardNodes.forEach((c,idx)=> {
    c.style.transform = `translateX(-50%) translateY(-6px) rotate(${(idx - 2.5)*8}deg)`;
    c.style.opacity = '0';
    setTimeout(()=>{ c.style.transition='opacity .25s, transform .35s'; c.style.opacity='1'; c.style.transform = `translateX(-50%) translateY(-14px) rotate(${(idx - 2.5)*8}deg)`; }, idx*50);
  });
  // show energy fill briefly to simulate sprightliness (not required but nice)
  energyFill.style.width = '60%';
  // stop shake audio after short time
  setTimeout(()=>{ sfxStopShake(); tubeAnim.cancel(); }, 1400);
});

/* when user taps one of the 6 cards */
function onChooseCard(e){
  if(hasDrawn) return;
  const el = e.currentTarget;
  const idx = parseInt(el.dataset.index,10);
  // prevent double click
  disableAllCards();
  // play swipe sound + vibrate
  sfxSwipe();
  navigator.vibrate?.(120);
  // determine result
  let result = fortunes[idx];
  // gift roll 10%
  const isGift = Math.random() < GIFT_PROB;
  if(isGift) result = {...result, gift:true};
  // VIP check: if sessionStorage VIP set (we asked earlier optionally) OR you want to check DOB, but user didn't input DOB in new flow.
  const vipDob = sessionStorage.getItem('vipDob') || null;
  if(vipDob === VIP_DATE){
    result = {id:'VIP', title:'Thi·∫øu gia VIP 10/5', text:'H√†o quang r·ª±c r·ª°! B·∫°n tr√∫ng qu·∫ª VIP. Mang m√†n h√¨nh ƒë·∫øn qu·∫ßy 10/5 ƒë·ªÉ nh·∫≠n qu√† VIP.', category:'vip', gift:true};
  }
  // save and display with animation
  const final = {...result, ts: Date.now()};
  localStorage.setItem(STORAGE_KEY, JSON.stringify(final));
  hasDrawn = true;
  // reveal animation: chosen card pops up, others fade
  revealChosenCard(el, final);
}

/* disable other card clicks */
function disableAllCards(){
  const cs = document.querySelectorAll('.card');
  cs.forEach(c=>{ c.removeEventListener('click', onChooseCard); c.classList.remove('shake'); c.style.cursor='default'; });
}

/* animate reveal */
function revealChosenCard(chosenEl, result){
  // fade others
  const others = Array.from(document.querySelectorAll('.card')).filter(c=>c!==chosenEl);
  others.forEach((c,i)=>{ c.style.transition='transform .4s, opacity .4s'; c.style.opacity='0'; c.style.transform = 'translateY(40px) scale(.8)'; });
  // chosen pops
  chosenEl.style.transition='transform .45s, box-shadow .3s';
  chosenEl.style.transform = 'translateX(-50%) translateY(-48px) scale(1.18) rotate(0deg)';
  chosenEl.style.boxShadow = '0 24px 40px rgba(0,0,0,.45)';
  // after a brief delay, show textual result panel
  setTimeout(()=> {
    displayResult(result, false);
  }, 420);
}

/* display result UI + sfx + confetti */
function displayResult(res, fromStorage){
  // build html
  const t = document.createElement('div');
  if(res.category === 'vip' || (res.title && String(res.title).toLowerCase().includes('vip'))){
    t.innerHTML = `<strong>K·∫øt qu·∫£ (VIP):</strong> ${escapeHtml(res.title)} <span class="vip-badge">VIP</span><div style="margin-top:8px">${escapeHtml(res.text)}</div>`;
    resultBox.classList.add('good'); resultBox.classList.remove('bad');
    try{ sfxWin(); }catch(e){}; confetti({particleCount:180,spread:90,origin:{y:0.35}});
    navigator.vibrate?.(200);
  } else {
    const cls = res.category === 'good' ? 'good' : 'bad';
    if(cls==='good'){ resultBox.classList.add('good'); resultBox.classList.remove('bad'); try{ sfxWin(); }catch(e){}; confetti({particleCount:120,spread:70,origin:{y:0.35}}); }
    else { resultBox.classList.add('bad'); resultBox.classList.remove('good'); try{ sfxSad(); }catch(e){}; navigator.vibrate?.([60,40,60]); }
    t.innerHTML = `<strong>K·∫øt qu·∫£:</strong> ${escapeHtml(res.title)}<div style="margin-top:8px;font-weight:700">${escapeHtml(res.text)}</div><div style="margin-top:8px;color:#6b4a39;font-size:.9rem">Qu·∫ª ID: ${escapeHtml(String(res.id))} ¬∑ ${new Date(res.ts).toLocaleString()}</div>`;
  }
  // gift note
  if(res.gift){
    const note = document.createElement('div');
    note.className = 'notice';
    note.innerHTML = 'üéÅ CH√öC M·ª™NG! B·∫°n tr√∫ng <strong>M√≥c kh√≥a</strong>! H√ÉY MANG M√ÄN H√åNH ƒê·∫æN G·∫∂P NH√ÇN VI√äN QU·∫¶Y 10/5 ƒê·ªÇ NH·∫¨N QU√Ä.';
    t.appendChild(note);
  }
  // replace resultBox content
  resultBox.innerHTML = '';
  resultBox.appendChild(t);
  // lock UI (no more draws)
  btnShake.disabled = true;
  // clear cards area but keep chosen card visual for a moment
  setTimeout(()=>{ cardsArea.innerHTML = ''; }, 1400);
}

/* helper: pick N distinct indices (0-based) */
function pickSixUnique(maxLen, n){
  const set = new Set();
  while(set.size < n){
    set.add(Math.floor(Math.random() * maxLen));
  }
  return Array.from(set);
}

/* small sanitize for inserting text */
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* reset (dev) */
btnReset.addEventListener('click', ()=>{
  localStorage.removeItem(STORAGE_KEY);
  sessionStorage.removeItem('vipDob');
  hasDrawn = false; storedResult = null;
  resultBox.innerHTML = '<div id="status"><strong>Tr·∫°ng th√°i:</strong> Ch∆∞a r√∫t qu·∫ª</div><div id="hint" style="margin-top:8px;color:#5a4038">B·∫•m B·∫ÆT ƒê·∫¶U ‚Üí X√≥c ‚Üí Ch·ªçn 1 trong 6 l√°.</div>';
  cardsArea.innerHTML = '';
  btnShake.disabled = true;
  alert('ƒê√£ reset (localStorage cleared).');
});

/* optional VIP prompt on first load (non-blocking) */
(function askForDOB(){
  if(!localStorage.getItem(STORAGE_KEY) && !sessionStorage.getItem('vipDobAsked')){
    sessionStorage.setItem('vipDobAsked','1');
    setTimeout(()=>{
      const want = confirm('Mu·ªën nh·∫≠p ng√†y sinh ƒë·ªÉ ch·ªù qu·∫ª VIP n·∫øu ƒë√∫ng 2010-06-25? (B·∫°n c√≥ th·ªÉ b·ªè qua)');
      if(want){
        const d = prompt('Nh·∫≠p ng√†y sinh (YYYY-MM-DD), v√≠ d·ª• 2010-06-25');
        if(d) sessionStorage.setItem('vipDob', d.trim());
      }
    }, 900);
  }
})();

/* Ensure audio context resumes on first real gesture (some browsers require) */
document.addEventListener('click', async function resumeAudioOnce(){
  try{ ensureAudio(); if(audioCtx.state==='suspended') await audioCtx.resume(); }catch(e){}
  document.removeEventListener('click', resumeAudioOnce);
});
</script>

</body>
</html
